<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNK STORE | Digital Asset Vault</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Fonts & Animations -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideInRight { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        .animate-slide-up { animation: slideUp 0.4s ease-out; }
        .animate-slide-in-right { animation: slideInRight 0.3s ease-out; }
        .animate-zoom-in { animation: zoomIn 0.3s ease-out; }
        .animate-pulse-slow { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>

    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl overflow-hidden relative border-x border-gray-100 text-gray-900">
        <!-- Content injected by JS -->
    </div>

    <script>
        // --- Configuration ---
        const SITE_NAME = "SYNK STORE";
        const GCASH_QR_URL = "https://upload.wikimedia.org/wikipedia/commons/d/d0/QR_code_for_mobile_English_Wikipedia.svg"; 
        const GCASH_NUMBER = "0917 123 4567";
        const apiKey = ""; // Enter Gemini API Key Here

        const PRODUCTS = [
            {
                id: 1,
                title: "SHEIN Account | 73% OFF Capped",
                tag: "BEST SELLER",
                price: 35,
                bulkPrice: 30,
                bulkThreshold: 10,
                description: "Premium verified accounts with 73% off voucher capped at 469. Instant delivery.",
                image: "https://api.iconify.design/simple-icons:shein.svg?color=%23000000",
                color: "bg-gray-100"
            },
            {
                id: 2,
                title: "SHEIN Account | 70% OFF Capped",
                tag: "HOT DEAL",
                price: 20,
                bulkPrice: 15,
                bulkThreshold: 10,
                description: "Standard verified accounts with 70% off voucher capped at 410. Perfect for daily use.",
                image: "https://api.iconify.design/simple-icons:shein.svg?color=%23333333",
                color: "bg-gray-50"
            }
        ];

        // --- State Management ---
        const state = {
            view: 'home', // home, product, checkout, success, tracker, admin
            orders: [],
            selectedProduct: null,
            quantity: 1,
            refNumber: '',
            lastOrderId: null,
            trackerInput: '',
            searchResult: null,
            adminAuth: false,
            adminTab: 'orders', // orders, otp
            activeFulfillmentId: null,
            fulfillmentText: '',
            aiLoading: false,
            aiContent: null // { type, text }
        };

        // --- Helpers ---
        const formatPHP = (amount) => new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(amount);
        const generateOrderId = () => 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        const formatDate = (dateStr) => new Date(dateStr).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        
        // --- Core Logic ---

        function init() {
            const savedOrders = localStorage.getItem('synk_orders');
            if (savedOrders) state.orders = JSON.parse(savedOrders);
            render();
        }

        function saveOrders() {
            localStorage.setItem('synk_orders', JSON.stringify(state.orders));
        }

        function setView(view) {
            state.view = view;
            if(view === 'home') {
                state.quantity = 1;
                state.refNumber = '';
            }
            render();
        }

        function selectProduct(id) {
            state.selectedProduct = PRODUCTS.find(p => p.id === id);
            state.quantity = 1;
            setView('product');
        }

        function updateQuantity(change) {
            const newQty = state.quantity + change;
            if (newQty >= 1) {
                state.quantity = newQty;
                render(); // Re-render to update price calculations
            }
        }

        function getPrice() {
            if (!state.selectedProduct) return 0;
            return state.quantity >= state.selectedProduct.bulkThreshold 
                ? state.selectedProduct.bulkPrice 
                : state.selectedProduct.price;
        }

        function submitOrder() {
            const refInput = document.getElementById('refNumberInput');
            if (!refInput || !refInput.value.trim()) {
                alert("Please enter the payment reference number.");
                return;
            }
            
            const newOrder = {
                id: generateOrderId(),
                date: new Date().toISOString(),
                product: state.selectedProduct.title,
                quantity: state.quantity,
                total: getPrice() * state.quantity,
                refNumber: refInput.value.trim(),
                status: 'Processing',
                accounts: [] 
            };

            state.orders.unshift(newOrder);
            state.lastOrderId = newOrder.id;
            saveOrders();
            setView('success');
        }

        // --- Tracking Logic ---
        function handleTrack() {
            const input = document.getElementById('trackerInputVal');
            if(input) state.trackerInput = input.value.trim();
            
            const found = state.orders.find(o => o.id === state.trackerInput);
            state.searchResult = found || 'not-found';
            state.aiContent = null;
            render();
        }

        function cancelOrder(id) {
            const order = state.orders.find(o => o.id === id);
            if (!order) return;
            
            const timeDiff = new Date() - new Date(order.date);
            if (timeDiff < 60000) {
                if(confirm('Cancel this order? This action cannot be undone.')) {
                    order.status = 'Cancelled';
                    state.searchResult = order; // Update current view
                    saveOrders();
                    render();
                }
            } else {
                alert('Cancellation window (1 minute) has expired.');
            }
        }

        function toggleAccountUsed(orderId, accId) {
            const order = state.orders.find(o => o.id === orderId);
            if(order) {
                const acc = order.accounts.find(a => a.id === accId);
                if(acc) {
                    acc.used = !acc.used;
                    saveOrders();
                    render();
                }
            }
        }

        function requestOtp(orderId, accId) {
            const order = state.orders.find(o => o.id === orderId);
            if(order) {
                const acc = order.accounts.find(a => a.id === accId);
                if(acc) {
                    acc.otpRequest = { status: 'pending', code: null, requestedAt: new Date().toISOString() };
                    saveOrders();
                    render();
                }
            }
        }

        // --- Admin Logic ---
        function handleAdminLogin() {
            const pass = document.getElementById('adminPassInput').value;
            if (pass === 'admin123') {
                state.adminAuth = true;
                render();
            } else {
                alert('Invalid Access Code');
            }
        }

        function fulfillOrder(id) {
            const text = document.getElementById('fulfillmentTextArea').value;
            if (!text.trim()) return alert("Please enter accounts");

            const accountLines = text.trim().split('\n').filter(line => line.trim() !== '');
            const newAccounts = accountLines.map((line, index) => ({
                id: `acc-${Date.now()}-${index}`,
                creds: line.trim(),
                used: false,
                otpRequest: { status: 'idle', code: null, requestedAt: null }
            }));

            const order = state.orders.find(o => o.id === id);
            if(order) {
                order.status = 'Completed';
                order.accounts = newAccounts;
                state.activeFulfillmentId = null;
                saveOrders();
                render();
            }
        }

        function sendOtp(orderId, accId, code) {
            const order = state.orders.find(o => o.id === orderId);
            if(order) {
                const acc = order.accounts.find(a => a.id === accId);
                if(acc) {
                    acc.otpRequest.status = 'sent';
                    acc.otpRequest.code = code;
                    saveOrders();
                    render();
                }
            }
        }

        function getPendingOtpCount() {
            let count = 0;
            state.orders.forEach(o => {
                if (o.accounts) {
                    o.accounts.forEach(a => {
                        if (a.otpRequest.status === 'pending') count++;
                    });
                }
            });
            return count;
        }

        // --- AI Logic ---
        async function callGemini(prompt, type) {
            state.aiLoading = true;
            state.aiContent = null;
            render(); // Show loading state

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
                    }
                );
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "System busy.";
                state.aiContent = { type, text };
            } catch (e) {
                console.error(e);
                state.aiContent = { type, text: "Connection error. Check API Key." };
            }
            
            state.aiLoading = false;
            render();
        }

        // --- Render Functions (View Templates) ---

        function renderHeader() {
            return `
            <div class="sticky top-0 z-40 bg-white border-b border-gray-100">
                <div class="flex justify-between items-center h-14 px-4">
                    <div class="flex items-center gap-4">
                        <button class="text-gray-800"><i data-lucide="menu" class="w-5 h-5"></i></button>
                        <button onclick="setView('home')" class="font-black text-lg tracking-tight italic">${SITE_NAME}</button>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="setView('tracker')" class="relative"><i data-lucide="user" class="w-5 h-5 text-gray-800"></i></button>
                        <button onclick="setView('admin')"><i data-lucide="settings" class="w-5 h-5 text-gray-800"></i></button>
                    </div>
                </div>
            </div>`;
        }

        function renderHome() {
            return `
            <div class="pb-16 animate-fade-in">
                <div class="bg-black text-white p-5 mb-6 relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex items-center gap-2 mb-2 text-emerald-400">
                            <i data-lucide="lock" class="w-3 h-3 fill-current"></i>
                            <p class="text-[10px] font-bold tracking-[0.2em] uppercase">SECURED TRANSACTION</p>
                        </div>
                        <h1 class="text-2xl font-bold leading-none mb-3 tracking-tighter">BUY AN ACCOUNT<br/>ANONYMOUSLY.</h1>
                        <p class="text-[10px] text-gray-400 max-w-[200px] leading-relaxed">Fresh made accounts and delivered fast to your dashboard.</p>
                    </div>
                    <div class="absolute right-0 top-0 h-full w-24 bg-gradient-to-l from-zinc-800 to-transparent opacity-50 transform skew-x-12"></div>
                </div>

                <div class="px-4">
                    <div class="flex justify-between items-end mb-4 border-b border-gray-100 pb-2">
                        <h2 class="font-bold text-sm tracking-wide">INVENTORY</h2>
                    </div>
                    <div class="grid grid-cols-1 gap-3">
                        ${PRODUCTS.map(p => `
                        <div onclick="selectProduct(${p.id})" class="group cursor-pointer bg-white border border-gray-100 p-3 flex gap-4 hover:border-black transition-colors">
                            <div class="w-20 h-20 ${p.color} flex items-center justify-center shrink-0">
                                <img src="${p.image}" class="w-10 h-10 opacity-80 group-hover:scale-110 transition-transform" alt="logo" />
                            </div>
                            <div class="flex flex-col justify-between py-1 w-full">
                                <div>
                                    <div class="flex justify-between items-start">
                                        <h3 class="text-xs font-bold uppercase tracking-wide">${p.title}</h3>
                                        <span class="bg-black text-white text-[9px] font-bold px-2 py-1 uppercase tracking-wider rounded-sm">${p.tag}</span>
                                    </div>
                                    <p class="text-[10px] text-gray-400 mt-1 line-clamp-2">${p.description}</p>
                                </div>
                                <div class="flex justify-between items-end">
                                    <span class="text-sm font-bold">${formatPHP(p.price)}</span>
                                    <span class="text-[9px] text-gray-400 uppercase">Min. 10 for Bulk</span>
                                </div>
                            </div>
                        </div>
                        `).join('')}
                    </div>
                </div>
                 <div class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-black/90 text-white text-[10px] px-4 py-2 rounded-none backdrop-blur-sm flex items-center gap-2 shadow-lg z-40 whitespace-nowrap border border-gray-800">
                   <i data-lucide="trending-up" class="w-3 h-3 text-emerald-500"></i>
                   <span class="tracking-wide">LIVE: User88 just bought 50x Accounts</span>
                 </div>
            </div>`;
        }

        function renderProduct() {
            const p = state.selectedProduct;
            const total = getPrice() * state.quantity;
            const isBulk = state.quantity >= p.bulkThreshold;

            return `
            <div class="pb-24 animate-slide-in-right">
                <div class="relative h-48 bg-gray-50 flex items-center justify-center mb-6">
                    <button onclick="setView('home')" class="absolute top-4 left-4 p-2 hover:bg-white rounded-full transition-colors z-10"><i data-lucide="arrow-left" class="w-5 h-5"></i></button>
                    <img src="${p.image}" class="w-24 h-24 opacity-80 grayscale" alt="product" />
                </div>
                <div class="px-6">
                    <h1 class="text-lg font-bold uppercase mb-2 leading-tight tracking-wide">${p.title}</h1>
                    <p class="text-gray-500 text-xs mb-6 leading-relaxed">${p.description}</p>

                    <div class="bg-gray-50 p-4 mb-6 border border-gray-100">
                        <div class="flex justify-between items-center mb-2 ${!isBulk ? 'text-black' : 'text-gray-400'}">
                            <span class="text-xs uppercase font-bold">Standard Price</span>
                            <span class="font-mono text-sm">${formatPHP(p.price)}</span>
                        </div>
                        <div class="flex justify-between items-center ${isBulk ? 'text-emerald-600' : 'text-gray-400'}">
                            <span class="text-xs uppercase font-bold flex items-center gap-1">Bulk Price (10+) ${isBulk ? '<i data-lucide="check-circle" class="w-3 h-3"></i>' : ''}</span>
                            <span class="font-mono text-sm">${formatPHP(p.bulkPrice)}</span>
                        </div>
                    </div>

                    <div class="flex items-center justify-between mb-8">
                        <span class="text-xs font-bold uppercase tracking-widest">Quantity</span>
                        <div class="flex items-center border border-black">
                            <button onclick="updateQuantity(-1)" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100">-</button>
                            <span class="w-12 text-center text-sm font-mono font-bold">${state.quantity}</span>
                            <button onclick="updateQuantity(1)" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100">+</button>
                        </div>
                    </div>
                </div>

                <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 safe-area-bottom z-20">
                    <div class="max-w-md mx-auto flex items-center gap-4">
                        <div class="flex-1">
                            <span class="text-[10px] uppercase text-gray-400 block mb-1">Total Payment</span>
                            <span class="text-xl font-bold font-mono">${formatPHP(total)}</span>
                        </div>
                        <button onclick="setView('checkout')" class="flex-1 bg-black text-white font-bold py-3 px-4 text-xs uppercase flex items-center justify-center gap-2 hover:bg-gray-800">
                            Checkout <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>`;
        }

        function renderCheckout() {
            const total = getPrice() * state.quantity;
            return `
            <div class="min-h-screen bg-white pb-20 animate-fade-in">
                <div class="p-4 border-b border-gray-100 flex items-center gap-4 sticky top-0 bg-white z-10">
                    <button onclick="setView('product')"><i data-lucide="arrow-left" class="w-4 h-4"></i></button>
                    <h2 class="font-black text-xs uppercase tracking-widest">Confirm Order</h2>
                </div>
                <div class="p-6">
                    <div class="bg-gray-50 p-4 mb-6 border border-gray-100">
                        <div class="flex justify-between mb-2 text-sm">
                            <span class="font-medium text-xs uppercase text-gray-500">${state.selectedProduct.title}</span>
                            <span class="font-mono font-bold">x${state.quantity}</span>
                        </div>
                        <div class="border-t border-gray-200 my-2 pt-2 flex justify-between items-center">
                            <span class="font-bold text-xs uppercase">Total Due</span>
                            <span class="text-xl font-mono font-bold">${formatPHP(total)}</span>
                        </div>
                    </div>
                    <div class="mb-8 text-center">
                        <p class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-4">Scan via GCash</p>
                        <div class="inline-block border p-4 bg-white shadow-sm">
                            <img src="${GCASH_QR_URL}" alt="QR" class="w-40 h-40 object-cover mb-2 mix-blend-multiply" />
                            <p class="font-mono font-bold">${GCASH_NUMBER}</p>
                        </div>
                    </div>
                    <div>
                        <div class="mb-4">
                            <label class="block text-[10px] font-bold uppercase text-gray-500 mb-1 tracking-wider">Payment Reference No.</label>
                            <input type="text" id="refNumberInput" placeholder="e.g. 1004 5678 9012" class="w-full border-b border-gray-300 py-2 text-sm focus:outline-none focus:border-black bg-transparent placeholder-gray-300 font-medium" />
                        </div>
                        <button onclick="submitOrder()" class="w-full bg-black text-white font-bold py-3 px-4 text-xs uppercase mt-6 hover:bg-gray-800">Submit Order</button>
                    </div>
                </div>
            </div>`;
        }

        function renderSuccess() {
            return `
            <div class="min-h-screen flex flex-col items-center justify-center p-8 text-center bg-white animate-zoom-in">
                <div class="w-12 h-12 bg-black text-white rounded-full flex items-center justify-center mb-6 shadow-lg shadow-gray-200">
                    <i data-lucide="check-circle" class="w-6 h-6"></i>
                </div>
                <h2 class="text-2xl font-bold tracking-tight mb-2">ORDER PLACED</h2>
                <p class="text-gray-400 text-xs mb-8 max-w-[200px] leading-relaxed">We have received your payment reference. Verification takes 10-30 minutes.</p>
                <div class="bg-gray-50 border border-gray-200 p-4 w-full mb-6 relative group">
                    <p class="text-[9px] text-gray-400 uppercase tracking-widest mb-1">Your Order ID</p>
                    <p class="text-lg font-mono font-bold">${state.lastOrderId}</p>
                    <button onclick="navigator.clipboard.writeText('${state.lastOrderId}'); alert('Copied!')" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-black p-2">
                        <i data-lucide="copy" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="space-y-3 w-full">
                    <button onclick="setView('tracker')" class="w-full border border-black text-black font-bold py-3 px-4 text-xs uppercase hover:bg-gray-50">Track Order</button>
                    <button onclick="goHome()" class="w-full text-gray-500 font-bold py-3 px-4 text-xs uppercase hover:text-black">Back to Store</button>
                </div>
            </div>`;
        }

        function renderTracker() {
            const res = state.searchResult;
            let content = '';

            if (!res) {
                 // Initial State
                 content = ``;
            } else if (res === 'not-found') {
                content = `
                <div class="animate-slide-up text-center p-8 text-gray-400 border border-dashed border-gray-300 bg-white mt-4">
                    <i data-lucide="package" class="w-6 h-6 mx-auto mb-2 opacity-50"></i>
                    <p class="text-xs">No order found with that ID.</p>
                </div>`;
            } else {
                // Order Found
                const isProcessing = res.status === 'Processing';
                const isCompleted = res.status === 'Completed';
                const timeDiff = new Date() - new Date(res.date);
                const canCancel = isProcessing && timeDiff < 60000;

                let accountsHtml = '';
                if(isCompleted && res.accounts && res.accounts.length > 0) {
                    accountsHtml = `
                    <div class="bg-white border border-gray-200 shadow-sm overflow-hidden mt-4">
                        <div class="bg-gray-900 text-white p-3 flex justify-between items-center">
                            <h3 class="text-xs font-bold uppercase tracking-widest flex items-center gap-2"><i data-lucide="user" class="w-3 h-3"></i> Your Accounts</h3>
                            <button onclick="handleTrack()" class="text-gray-400 hover:text-white"><i data-lucide="refresh-cw" class="w-3 h-3"></i></button>
                        </div>
                        <div class="divide-y divide-gray-100 max-h-[400px] overflow-y-auto">
                            ${res.accounts.map((acc, idx) => `
                            <div class="p-4 transition-all ${acc.used ? 'bg-gray-50' : 'bg-white'}">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-[10px] text-gray-400 font-mono">#${idx + 1}</span>
                                    <div class="flex gap-2">
                                        <button onclick="toggleAccountUsed('${res.id}', '${acc.id}')" class="text-[9px] ${acc.used ? 'text-gray-400' : 'text-gray-400 hover:text-red-600'} uppercase font-bold flex items-center gap-1">
                                            ${acc.used ? '<i data-lucide="trash-2" class="w-3 h-3"></i> Undo' : 'Mark Used'}
                                        </button>
                                    </div>
                                </div>
                                <div class="font-mono text-sm mb-3 select-all break-all ${acc.used ? 'line-through text-gray-400' : 'text-black'}">${acc.creds}</div>
                                <div class="p-2 rounded border flex items-center justify-between gap-2 transition-colors ${acc.used ? 'border-gray-100 bg-gray-100 opacity-50 pointer-events-none' : 'border-gray-100 bg-gray-50'}">
                                    ${acc.otpRequest.status === 'sent' ? `
                                    <div class="flex items-center gap-2 w-full justify-between">
                                        <span class="text-[10px] font-bold text-gray-500 uppercase">OTP Code:</span>
                                        <div class="flex items-center gap-2">
                                            <span class="font-mono font-bold text-emerald-600 text-lg tracking-widest">${acc.otpRequest.code}</span>
                                            <i data-lucide="copy" class="w-3 h-3 text-gray-400 cursor-pointer" onclick="navigator.clipboard.writeText('${acc.otpRequest.code}')"></i>
                                        </div>
                                    </div>` : acc.otpRequest.status === 'pending' ? `
                                    <div class="flex items-center gap-2 w-full text-yellow-600 justify-center py-1">
                                        <i data-lucide="clock" class="w-3 h-3 animate-spin"></i>
                                        <span class="text-[10px] font-bold uppercase tracking-wide">Waiting for Admin...</span>
                                    </div>` : `
                                    <div class="flex items-center justify-between w-full">
                                        <span class="text-[10px] text-gray-400 uppercase">Need Login Code?</span>
                                        <button onclick="requestOtp('${res.id}', '${acc.id}')" class="bg-white border border-black text-black text-[9px] font-bold px-3 py-1 uppercase hover:bg-black hover:text-white transition-colors">Request OTP</button>
                                    </div>`}
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>`;
                }

                let aiSection = '';
                if(isCompleted) {
                    aiSection = `
                    <div class="mt-4 pt-4 border-t border-gray-100">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] font-bold uppercase tracking-wider flex items-center gap-1 text-indigo-600"><i data-lucide="sparkles" class="w-3 h-3"></i> AI Command</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="callGemini('Provide 3 critical, strict bullet points on how to safely use a ${res.product} without getting flagged or banned. Tone: Professional, secretive, like a mission briefing. Max 50 words.', 'security')" 
                                class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white hover:opacity-90 font-bold py-2 px-3 text-[10px] uppercase rounded-none disabled:opacity-50" ${state.aiLoading ? 'disabled' : ''}>
                                ${state.aiLoading && state.aiContent?.type === 'security' ? 'Decrypting...' : 'Security Protocol ✨'}
                            </button>
                            <button onclick="callGemini('Write a short, high-energy social media caption for a reseller selling ${res.product}. Use emojis. Do not mention specific prices. Create a sense of urgency. Max 30 words.', 'reseller')" 
                                class="border border-black text-black hover:bg-gray-50 font-bold py-2 px-3 text-[10px] uppercase rounded-none disabled:opacity-50" ${state.aiLoading ? 'disabled' : ''}>
                                ${state.aiLoading && state.aiContent?.type === 'reseller' ? 'Drafting...' : 'Resell Caption ✨'}
                            </button>
                        </div>
                        ${state.aiContent ? `
                        <div class="mt-3 bg-gray-900 text-emerald-400 p-3 text-xs font-mono rounded-sm relative overflow-hidden animate-fade-in">
                            <div class="absolute top-0 right-0 p-1 opacity-50"><i data-lucide="${state.aiContent.type === 'security' ? 'shield-alert' : 'share-2'}" class="w-3 h-3"></i></div>
                            <p class="uppercase text-[9px] text-gray-500 mb-2 border-b border-gray-800 pb-1">${state.aiContent.type === 'security' ? 'Protocol Decrypted' : 'Social Copy Generated'}</p>
                            <div class="whitespace-pre-wrap leading-relaxed">${state.aiContent.text}</div>
                        </div>` : ''}
                    </div>`;
                }

                content = `
                <div class="space-y-4 animate-slide-up mt-4">
                    <div class="bg-white border border-gray-200 p-5 shadow-sm relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full ${isCompleted ? 'bg-emerald-500' : (res.status === 'Cancelled' ? 'bg-red-500' : 'bg-yellow-400')}"></div>
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-sm tracking-tight mb-1">${res.id}</h3>
                                <p class="text-[10px] text-gray-400">${formatDate(res.date)}</p>
                            </div>
                            <span class="${isCompleted ? 'bg-emerald-100 text-emerald-700' : (res.status === 'Cancelled' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700')} text-[9px] font-bold px-2 py-1 uppercase tracking-wider rounded-sm">${res.status}</span>
                        </div>
                        <div class="border-t border-gray-100 pt-3 space-y-1">
                            <div class="flex justify-between text-xs">
                                <span class="text-gray-500">Item</span>
                                <span class="font-medium truncate max-w-[150px]">${res.product}</span>
                            </div>
                             <div class="flex justify-between text-xs">
                                <span class="text-gray-500">Total</span>
                                <span class="font-bold font-mono">${formatPHP(res.total)}</span>
                            </div>
                        </div>
                        ${canCancel ? `
                        <div class="mt-4 pt-3 border-t border-gray-100">
                            <button onclick="cancelOrder('${res.id}')" class="w-full bg-red-600 text-white hover:bg-red-700 font-bold py-2 px-3 text-[10px] uppercase">Cancel Order (Undo)</button>
                            <p class="text-[9px] text-gray-400 text-center mt-2">Available for 1 minute after purchase</p>
                        </div>` : ''}
                        ${aiSection}
                    </div>
                    ${accountsHtml}
                </div>`;
            }

            return `
            <div class="min-h-screen bg-gray-50 pb-20 font-sans">
                <div class="p-4 bg-white border-b border-gray-100 flex items-center gap-4 sticky top-0 z-10">
                    <button onclick="goHome()" class="hover:bg-gray-100 p-1 rounded-full"><i data-lucide="arrow-left" class="w-4 h-4"></i></button>
                    <span class="text-xs font-black uppercase tracking-widest">Order Tracking</span>
                </div>
                <div class="p-4 max-w-md mx-auto">
                    <div class="bg-white border border-gray-200 p-5 shadow-sm mb-4">
                        <div class="mb-4">
                            <label class="block text-[10px] font-bold uppercase text-gray-500 mb-1 tracking-wider">Order ID</label>
                            <input type="text" id="trackerInputVal" value="${state.trackerInput}" placeholder="ORD-XXXXXXXX" class="w-full border-b border-gray-300 py-2 text-sm focus:outline-none focus:border-black bg-transparent placeholder-gray-300 font-medium" />
                        </div>
                        <button onclick="handleTrack()" class="w-full bg-black text-white font-bold py-3 px-4 text-xs uppercase hover:bg-gray-800">Find Order</button>
                    </div>
                    ${content}
                </div>
            </div>`;
        }

        function renderAdmin() {
            if (!state.adminAuth) {
                return `
                <div class="min-h-screen bg-gray-100 text-gray-900 font-sans flex items-center justify-center">
                    <div class="bg-white p-8 shadow-xl max-w-sm w-full border-t-4 border-black">
                         <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-center uppercase tracking-widest">Restricted Access</h3>
                            <button onclick="goHome()" class="text-xs hover:underline">Exit</button>
                         </div>
                        <div class="mb-6">
                            <label class="block text-[10px] font-bold uppercase text-gray-500 mb-1 tracking-wider">Secure Passkey</label>
                            <input type="password" id="adminPassInput" class="w-full border-b border-gray-300 py-2 text-sm focus:outline-none focus:border-black bg-transparent" />
                        </div>
                        <button onclick="handleAdminLogin()" class="w-full bg-black text-white font-bold py-3 px-4 text-xs uppercase hover:bg-gray-800">Authenticate</button>
                        <p class="text-center mt-4 text-[10px] text-gray-300">pass: admin123</p>
                    </div>
                </div>`;
            }

            const pending = state.orders.filter(o => o.status === 'Processing').length;
            const revenue = state.orders.reduce((acc, cur) => acc + cur.total, 0);
            const pendingOtp = getPendingOtpCount();

            // Orders Tab Content
            let tabContent = '';
            if (state.adminTab === 'orders') {
                tabContent = `
                <div class="bg-white shadow-sm border border-gray-200 overflow-hidden">
                    <table class="w-full text-left">
                        <tbody class="divide-y divide-gray-100">
                            ${state.orders.map(order => `
                            <tr class="hover:bg-gray-50 group">
                                <td class="p-4">
                                    <div class="flex items-center gap-2">
                                        <span class="font-bold text-sm">${order.id}</span>
                                        ${order.status === 'Processing' ? '<span class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse-slow"></span>' : ''}
                                    </div>
                                    <div class="text-xs text-gray-500 font-mono mt-1">Ref: ${order.refNumber}</div>
                                    <div class="text-[10px] text-gray-400 mt-1">${order.product} (x${order.quantity})</div>
                                </td>
                                <td class="p-4">
                                    <span class="${order.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' : (order.status === 'Cancelled' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700')} text-[9px] font-bold px-2 py-1 uppercase rounded-sm">${order.status}</span>
                                </td>
                                <td class="p-4 text-right">
                                    ${order.status === 'Processing' ? `
                                        <button onclick="state.activeFulfillmentId = '${order.id}'; render()" class="bg-black text-white px-2 py-1 text-[10px] uppercase font-bold">Fulfill</button>
                                    ` : order.status === 'Completed' ? '<span class="text-[10px] text-emerald-600 font-bold uppercase"><i data-lucide="check-circle" class="w-3 h-3 inline"></i> Sent</span>' : ''}
                                </td>
                            </tr>
                            ${state.activeFulfillmentId === order.id ? `
                            <tr>
                                <td colspan="3" class="bg-gray-50 p-6 border-y border-gray-200 animate-slide-up">
                                    <h4 class="text-[10px] font-bold uppercase mb-2 text-gray-500">Paste Accounts (One per line)</h4>
                                    <textarea id="fulfillmentTextArea" class="w-full border border-gray-300 p-3 text-xs font-mono h-32 mb-4 focus:border-black focus:outline-none rounded-sm" placeholder="user:pass"></textarea>
                                    <div class="flex justify-end gap-2">
                                        <button onclick="state.activeFulfillmentId = null; render()" class="text-gray-500 text-xs font-bold uppercase">Cancel</button>
                                        <button onclick="fulfillOrder('${order.id}')" class="bg-emerald-600 text-white px-3 py-1 text-[10px] uppercase font-bold">Complete & Send</button>
                                    </div>
                                </td>
                            </tr>` : ''}
                            `).join('')}
                        </tbody>
                    </table>
                </div>`;
            } else {
                // OTP Tab Content
                const pendingReqs = [];
                state.orders.forEach(o => {
                    if (o.accounts) o.accounts.forEach((a, idx) => {
                        if (a.otpRequest.status === 'pending') pendingReqs.push({ orderId: o.id, accId: a.id, creds: a.creds, idx: idx + 1, reqAt: a.otpRequest.requestedAt });
                    });
                });

                if (pendingReqs.length > 0) {
                    tabContent = `
                    <div class="bg-white shadow-sm border border-gray-200 divide-y divide-gray-100">
                        ${pendingReqs.map(req => `
                        <div class="p-4 bg-yellow-50/50 animate-slide-in-right">
                            <div class="mb-2">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-bold text-sm">${req.orderId}</span>
                                    <span class="text-[10px] bg-white border border-gray-200 px-1 rounded text-gray-500 uppercase font-bold">Account #${req.idx}</span>
                                </div>
                                <div class="font-mono text-sm px-2 py-1 inline-block border border-gray-200 bg-white text-gray-700 rounded-sm mb-1">${req.creds}</div>
                                <div class="flex items-center gap-1 text-[10px] text-gray-400"><i data-lucide="clock" class="w-3 h-3"></i> Requested: ${new Date(req.reqAt).toLocaleTimeString()}</div>
                            </div>
                            <div class="flex gap-2 items-center bg-white p-2 rounded shadow-sm border border-gray-100">
                                <input type="text" id="otp-input-${req.accId}" placeholder="Type Code" class="border border-gray-200 p-2 text-sm w-full focus:border-black focus:outline-none font-mono" />
                                <button onclick="sendOtp('${req.orderId}', '${req.accId}', document.getElementById('otp-input-${req.accId}').value)" class="bg-black text-white px-3 py-2 text-xs font-bold uppercase flex items-center gap-1"><i data-lucide="send" class="w-3 h-3"></i> Send</button>
                            </div>
                        </div>
                        `).join('')}
                    </div>`;
                } else {
                    tabContent = `<div class="p-12 text-center text-gray-400 bg-white border border-gray-200"><p class="text-xs font-bold uppercase">No pending OTP requests</p></div>`;
                }
            }

            return `
            <div class="min-h-screen bg-gray-100 text-gray-900 font-sans">
                <div class="bg-white border-b border-gray-200 p-4 flex justify-between items-center sticky top-0 z-50">
                    <h2 class="font-black text-sm tracking-widest flex items-center gap-2">SYNK ADMIN <span class="bg-red-500 text-white px-1 text-[9px] rounded-sm">V2.1</span></h2>
                    <button onclick="goHome()" class="text-xs font-bold hover:underline">LOGOUT</button>
                </div>
                <div class="max-w-5xl mx-auto p-4">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white p-4 border border-gray-200"><p class="text-[10px] text-gray-400 uppercase font-bold">Revenue</p><p class="text-xl font-bold font-mono">${formatPHP(revenue)}</p></div>
                        <div class="bg-white p-4 border border-gray-200"><p class="text-[10px] text-gray-400 uppercase font-bold">Orders</p><p class="text-xl font-bold">${state.orders.length}</p></div>
                        <div class="bg-white p-4 border border-gray-200"><p class="text-[10px] text-gray-400 uppercase font-bold">Pending</p><p class="text-xl font-bold text-yellow-600">${pending}</p></div>
                        <div onclick="state.adminTab = 'otp'; render()" class="bg-white p-4 border cursor-pointer hover:border-black transition-colors ${pendingOtp > 0 ? 'border-red-500 ring-1 ring-red-500' : 'border-gray-200'}">
                            <p class="text-[10px] text-gray-400 uppercase font-bold flex justify-between">OTP Req <i data-lucide="bell" class="w-3 h-3"></i></p>
                            <p class="text-xl font-bold text-red-600">${pendingOtp}</p>
                        </div>
                    </div>
                    <div class="flex gap-4 mb-4 border-b border-gray-200 pb-1">
                        <button onclick="state.adminTab = 'orders'; render()" class="text-xs font-bold uppercase pb-2 px-2 transition-colors ${state.adminTab === 'orders' ? 'border-b-2 border-black text-black' : 'text-gray-400 hover:text-gray-600'}">All Orders</button>
                        <button onclick="state.adminTab = 'otp'; render()" class="text-xs font-bold uppercase pb-2 px-2 transition-colors flex items-center gap-2 ${state.adminTab === 'otp' ? 'border-b-2 border-black text-black' : 'text-gray-400 hover:text-gray-600'}">OTP Center ${pendingOtp > 0 ? `<span class="bg-red-500 text-white px-1.5 rounded-full text-[9px] animate-pulse-slow">${pendingOtp}</span>` : ''}</button>
                    </div>
                    ${tabContent}
                </div>
            </div>`;
        }

        // --- Main Render Loop ---
        function render() {
            const app = document.getElementById('app');
            let html = '';

            if (state.view === 'admin') {
                html = renderAdmin();
            } else {
                html = renderHeader();
                if (state.view === 'home') html += renderHome();
                else if (state.view === 'product') html += renderProduct();
                else if (state.view === 'checkout') html += renderCheckout();
                else if (state.view === 'success') html += renderSuccess();
                else if (state.view === 'tracker') html += renderTracker();
            }

            app.innerHTML = html;
            lucide.createIcons();
        }

        // --- Initialization ---
        init();

    </script>
</body>
</html>
